<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galeon Hospitals Map</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.js"></script>
    <style>
        :root {
            --background-color-light: #f9f9f9;
            --text-color-light: #1f1f1f;
            --control-background-light: #ffffff;
            --control-border-light: #ddd;
            --hover-background-light: #f1f1f1;
            --hyperlink-color: #00aaff;

            --background-color-dark: #2b2b2b;
            --text-color-dark: #f1f1f1;
            --control-background-dark: #333;
            --control-border-dark: #555;
            --hover-background-dark: #444;

            --primary-color: #007bff;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --danger-color: #dc3545;
        }

        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background-color-light);
            color: var(--text-color-light);
            transition: background-color 0.3s, color 0.3s;
        }
    
        #map { height: 100%; width: 100%; }
    
        .controls {
            position: absolute;
            top: 10px;
            left: 60px;
            z-index: 1000;
            background: var(--control-background-light);
            color: var(--text-color-light);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.1);
            width: 220px;
            border: 1px solid var(--control-border-light);
        }

        .controls select, .controls input {
            margin-bottom: 10px;
            padding: 6px;
            border-radius: 4px;
            border: 1px solid var(--control-border-light);
            background-color: var(--control-background-light);
            color: var(--text-color-light);
            font-size: 14px;
            transition: border-color 0.3s ease, background-color 0.3s ease;
        }

        .controls select:focus, .controls input:focus {
            border-color: #007bff;
            outline: none;
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 14px;
            width: 100%;
        }

        .checkbox-group input[type="checkbox"] {
            margin-right: 8px;
            transform: scale(1.2);
            accent-color: #007bff;
        }

        .checkbox-group span {
            font-size: 14px;
            line-height: 1.2;
            flex-grow: 1;
        }

        #hamburger, #legend-toggle, #theme-toggle {
            position: fixed;
            z-index: 1000;
            width: 40px;
            height: 40px;
            background: var(--control-background-light);
            color: var(--text-color-light);
            border: 1px solid var(--control-border-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s, box-shadow 0.3s;
        }

        #hamburger {
                top: 85px;
                left: 8px;
        }

        #legend-toggle {
            bottom: 10px;
            left: 10px;
        }

        #theme-toggle {
            top: 10px;
            right: 10px;
        }

        .legend-container {
            position: fixed;
            bottom: 10px;
            left: 60px;
            z-index: 1001;
            background: var(--control-background-light);
            color: var(--text-color-light);
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            display: none;
        }

        .legend-container.open {
            display: block;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
        }

        .chart-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            background: var(--control-background-light);
            color: var(--text-color-light);
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        .gauge-wrapper {
            text-align: center;
            margin: 0 10px;
        }

        .gauge {
            width: 80px;
            height: 80px;
            position: relative;
        }

        .gauge-value {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 14px;
            font-weight: bold;
        }

        .gauge-percentage {
            font-size: 14px;
            margin-top: 5px;
        }

        .gauge-label {
            font-size: 14px;
            font-weight: bold;
            margin-top: 5px;
        }

        /* Styles pour les tags de statut */
        .status-tag {
            display: inline-block;
            padding: 4px 8px;
            margin: 5px;
            font-size: 12px;
            text-transform: uppercase;
            border-radius: 5px;
            color: white;
            cursor: pointer; /* Ajouter un curseur pointer pour indiquer que c'est cliquable */
        }

        /* Couleurs des tags */
        .status-deployed {
            background-color: #28a745;
        }

        .status-in-progress {
            background-color: #ffc107;
            color: #856404;
        }

        .status-signed {
            background-color: #007bff;
        }

        /* Styles des tags actifs */
        .status-tag.active {
            opacity: 0.7;
            border: 2px solid rgba(0, 0, 0, 0.1);
        }

        .status-deployed.active {
            background-color: #b0e2b5;
            color: #1e7b34;
        }

        .status-in-progress.active {
            background-color: #ffe5a0;
            color: #6e5002;
        }

        .status-signed.active {
            background-color: #9ecbff;
            color: #0056b3;
        }

        body.dark-mode {
            background-color: var(--background-color-dark);
            color: var(--text-color-dark);
        }

        body.dark-mode .controls,
        body.dark-mode .controls select,
        body.dark-mode .controls input,
        body.dark-mode #hamburger,
        body.dark-mode #legend-toggle,
        body.dark-mode #theme-toggle,
        body.dark-mode .legend-container,
        body.dark-mode .chart-container,
        body.dark-mode .leaflet-control-zoom-in, 
        body.dark-mode .leaflet-control-zoom-out {
            background-color: var(--control-background-dark);
            color: var(--text-color-dark);
            border-color: var(--control-border-dark);
        }

        body.dark-mode #theme-toggle {
            color: yellow;
        }

        .leaflet-popup-content-wrapper {
            background-color: var(--control-background-light);
            color: var(--text-color-light);
            border-radius: 8px;
            padding: 0;
            border: none;
            box-shadow: 0 3px 14px rgba(0,0,0,0.2);
            max-width: 250px;
            width: 300px;
        }

        .leaflet-popup-content {
            margin: 0;
            padding: 15px;
            width: auto !important;
        }

        .leaflet-popup-tip-container {
            display: none;
        }

        /* Styles du contenu du popup */
        .popup-content {
            text-align: center;
        }

        .popup-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
            word-wrap: break-word;
        }

        .popup-image {
            max-width: 100%;
            height: auto;
            margin-bottom: 10px;
        }

        .popup-content p {
            margin: 5px 0;
            word-wrap: break-word;
            overflow-wrap: break-word;
            font-size: 14px;
        }

        .popup-content a {
            color: var(--primary-color);
            text-decoration: none;
            word-break: break-all;
            font-size: 14px;
        }

        .popup-content a:hover {
            text-decoration: underline;
        }

        .leaflet-control-attribution {
            display: none;
        }

        /* Styles des popups pour le th√®me sombre */
        body.dark-mode .leaflet-popup-content,
        body.dark-mode .leaflet-popup-content-wrapper,
        body.dark-mode .leaflet-popup-tip {
            border: none !important;
            background-color: var(--control-background-dark);
            color: var(--text-color-dark);
            border: 1px solid var(--control-border-dark);
        }

        /* Ajuster pour mobile */
        @media (max-width: 768px) {
            .leaflet-popup-content-wrapper {
                border: none !important;
                box-shadow: none !important;
                padding: 0 !important;
                max-width: 220px;
                padding: 5px;
                width: 300px;
            }
            .leaflet-popup-content h3 {
                font-size: 14px;
            }
            .leaflet-popup-content img {
                width: 100px;
            }
            .leaflet-popup-content p, .leaflet-popup-content a {
                font-size: 12px;
            }

            .leaflet-popup-tip {
                border: none !important;
                box-shadow: none !important;
            }
            .gauge {
                width: 60px;
                height: 60px;
            }
            .legend-container {
                bottom: 150px;
                left: 10px;
            }
            .chart-container {
                position: fixed;
                bottom: 10px;
                left: 50%;
                transform: translateX(-50%);
                z-index: 1000;
                background: var(--control-background-light);
                color: var(--text-color-light);
                padding: 10px;
                border-radius: 8px;
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
                display: flex;
                justify-content: center;
                align-items: center;
                width: 280px;
            }
            #legend-toggle {
                top: 140px;
                left: 9px;
            }
            .controls {
                width: 180px;
                padding: 10px;
                font-size: 12px;
            }

            /* Style pour le statut */
            .status-tag {
                display: inline-block;
                padding: 2px 6px;
                border-radius: 4px;
                margin: 3px;
                font-size: 10px;
                text-transform: uppercase;
            }

            .status-deployed {
                background-color: #28a745;
                color: white;
            }

            .controls select, .controls input {
                font-size: 13px;
                padding: 5px;
            }
            .legend-item {
                margin-bottom: 3px;
            }
            .legend-color {
                width: 15px;
                height: 15px;
                margin-right: 5px;
            }
        }

        /* Supprimer les bordures et ombres non souhait√©es */
        .leaflet-popup-content-wrapper::before, 
        .leaflet-popup-content-wrapper::after {
            content: none;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <button id="hamburger">‚ò∞</button>
    <button id="legend-toggle"><i class="fas fa-info"></i></button>
    <div class="legend-container">
        <div class="legend-item"><span class="legend-color" style="background-color: green;"></span>Deployed</div>
        <div class="legend-item"><span class="legend-color" style="background-color: orange;"></span>In Progress</div>
        <div class="legend-item"><span class="legend-color" style="background-color: rgb(0, 140, 255);"></span>Signed</div>
    </div>
    <div class="controls">
        <select id="language-select">
            <option value="en">English</option>
            <option value="fr">French</option>
            <option value="es">Spanish</option>
            <option value="zh">Chinese</option>
            <option value="ar">Arabic</option>
            <option value="hi">Hindi</option>
            <option value="bn">Bengali</option>
            <option value="pt">Portuguese</option>
            <option value="ru">Russian</option>
            <option value="ja">Japanese</option>
            <option value="de">German</option>
            <option value="ko">Korean</option>
            <option value="vi">Vietnamese</option>
            <option value="vi">Vietnamese</option>
            <option value="tr">Turkish</option>
            <option value="fa">Persian</option>
            <option value="ur">Urdu</option>
            <option value="it">Italian</option>
            <option value="ta">Tamil</option>
            <option value="pl">Polish</option>
            <option value="nl">Dutch</option>
        </select>
        <select id="continent-select">
            <option value="">All</option>
            <option value="Europe">Europe</option>
            <option value="North America">North America</option>
            <option value="South America">South America</option>
            <option value="Asia">Asia</option>
            <option value="Africa">Africa</option>
            <option value="Oceania">Oceania</option>
        </select>
        <input type="text" id="country-filter" placeholder="Enter country...">
        <input type="text" id="city-filter" placeholder="Enter city...">
        <div class="status-filters">
            <span class="status-tag status-deployed" data-status="Deployed">Deployed</span>
            <span class="status-tag status-in-progress" data-status="In Progress">In Progress</span>
            <span class="status-tag status-signed" data-status="Signed">Signed</span>
        </div>
    </div>
    <div class="chart-container">
        <div class="gauge-wrapper">
            <div id="deployed-progress" class="gauge">
                <div class="gauge-value"></div>
            </div>
            <div class="gauge-percentage"></div>
            <div class="gauge-label">Deployed</div>
        </div>
        <div class="gauge-wrapper">
            <div id="in-progress-progress" class="gauge">
                <div class="gauge-value"></div>
            </div>
            <div class="gauge-percentage"></div>
            <div class="gauge-label">In Progress</div>
        </div>
        <div class="gauge-wrapper">
            <div id="signed-progress" class="gauge">
                <div class="gauge-value"></div>
            </div>
            <div class="gauge-percentage"></div>
            <div class="gauge-label">Signed</div>
        </div>
    </div>
    <button id="theme-toggle"><i class="fas fa-moon"></i></button>

    <script>
        let map, markers = [], activeStatus = [], language = "en";
        let darkMode = false;
        let isMapInitialized = false;
        let isChartInitialized = false;
        const gauges = {};
        const colors = {
            'Deployed': '#4CAF50',
            'In Progress': '#FFA500',
            'Signed': '#2196F3'
        };

        const translations = {
            en: {
                deployed: "Deployed",
                inProgress: "In Progress",
                signed: "Signed",
                enterCountry: "Enter country...",
                enterCity: "Enter city...",
                visitWebsite: "Visit Website",
                address: "Address",
                status: "Status",
                legendDeployed: "Deployed",
                legendInProgress: "In Progress",
                legendSigned: "Signed",
                noHospitals: "No hospitals available",
                gaugesDeployed: "Deployed",
                gaugesInProgress: "In Progress",
                gaugesSigned: "Signed"
            },
            fr: {
                deployed: "D√©ploy√©",
                inProgress: "En cours",
                signed: "Sign√©",
                enterCountry: "Entrer un pays...",
                enterCity: "Entrer une ville...",
                visitWebsite: "Visiter le site Web",
                address: "Adresse",
                status: "Statut",
                legendDeployed: "D√©ploy√©",
                legendInProgress: "En cours",
                legendSigned: "Sign√©",
                noHospitals: "Aucun h√¥pital disponible",
                gaugesDeployed: "D√©ploy√©",
                gaugesInProgress: "En cours",
                gaugesSigned: "Sign√©"
            },
            es: {
                deployed: "Desplegado",
                inProgress: "En progreso",
                signed: "Firmado",
                enterCountry: "Ingresar pa√≠s...",
                enterCity: "Ingresar ciudad...",
                visitWebsite: "Visitar sitio web",
                address: "Direcci√≥n",
                status: "Estado",
                legendDeployed: "Desplegado",
                legendInProgress: "En progreso",
                legendSigned: "Firmado",
                noHospitals: "No hay hospitales disponibles",
                gaugesDeployed: "Desplegado",
                gaugesInProgress: "En progreso",
                gaugesSigned: "Firmado"
            },
            zh: {
                deployed: "ÈÉ®ÁΩ≤",
                inProgress: "ËøõË°å‰∏≠",
                signed: "Â∑≤Á≠æÁΩ≤",
                enterCountry: "ËæìÂÖ•ÂõΩÂÆ∂...",
                enterCity: "ËæìÂÖ•ÂüéÂ∏Ç...",
                visitWebsite: "ËÆøÈóÆÁΩëÁ´ô",
                address: "Âú∞ÂùÄ",
                status: "Áä∂ÊÄÅ",
                legendDeployed: "ÈÉ®ÁΩ≤",
                legendInProgress: "ËøõË°å‰∏≠",
                legendSigned: "Â∑≤Á≠æÁΩ≤",
                noHospitals: "Ê≤°ÊúâÂèØÁî®ÁöÑÂåªÈô¢",
                gaugesDeployed: "ÈÉ®ÁΩ≤",
                gaugesInProgress: "ËøõË°å‰∏≠",
                gaugesSigned: "Â∑≤Á≠æÁΩ≤"
            },
            ar: {
                deployed: "ÿ™ŸÖ ÿßŸÑŸÜÿ¥ÿ±",
                inProgress: "ŸÇŸäÿØ ÿßŸÑÿ™ŸÜŸÅŸäÿ∞",
                signed: "ŸÖŸàŸÇÿπ",
                enterCountry: "ÿ£ÿØÿÆŸÑ ÿßŸÑÿØŸàŸÑÿ©...",
                enterCity: "ÿ£ÿØÿÆŸÑ ÿßŸÑŸÖÿØŸäŸÜÿ©...",
                visitWebsite: "ÿ≤Ÿäÿßÿ±ÿ© ÿßŸÑŸÖŸàŸÇÿπ",
                address: "ÿßŸÑÿπŸÜŸàÿßŸÜ",
                status: "ÿßŸÑÿ≠ÿßŸÑÿ©",
                legendDeployed: "ÿ™ŸÖ ÿßŸÑŸÜÿ¥ÿ±",
                legendInProgress: "ŸÇŸäÿØ ÿßŸÑÿ™ŸÜŸÅŸäÿ∞",
                legendSigned: "ŸÖŸàŸÇÿπ",
                noHospitals: "ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖÿ≥ÿ™ÿ¥ŸÅŸäÿßÿ™ ŸÖÿ™ÿßÿ≠ÿ©",
                gaugesDeployed: "ÿ™ŸÖ ÿßŸÑŸÜÿ¥ÿ±",
                gaugesInProgress: "ŸÇŸäÿØ ÿßŸÑÿ™ŸÜŸÅŸäÿ∞",
                gaugesSigned: "ŸÖŸàŸÇÿπ"
            },
            hi: {
                deployed: "‡§§‡•à‡§®‡§æ‡§§",
                inProgress: "‡§™‡•ç‡§∞‡§ó‡§§‡§ø ‡§Æ‡•á‡§Ç",
                signed: "‡§π‡§∏‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞‡§ø‡§§",
                enterCountry: "‡§¶‡•á‡§∂ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç...",
                enterCity: "‡§∂‡§π‡§∞ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç...",
                visitWebsite: "‡§µ‡•á‡§¨‡§∏‡§æ‡§á‡§ü ‡§™‡§∞ ‡§ú‡§æ‡§è‡§Ç",
                address: "‡§™‡§§‡§æ",
                status: "‡§∏‡•ç‡§•‡§ø‡§§‡§ø",
                legendDeployed: "‡§§‡•à‡§®‡§æ‡§§",
                legendInProgress: "‡§™‡•ç‡§∞‡§ó‡§§‡§ø ‡§Æ‡•á‡§Ç",
                legendSigned: "‡§π‡§∏‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞‡§ø‡§§",
                noHospitals: "‡§ï‡•ã‡§à ‡§Ö‡§∏‡•ç‡§™‡§§‡§æ‡§≤ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à",
                gaugesDeployed: "‡§§‡•à‡§®‡§æ‡§§",
                gaugesInProgress: "‡§™‡•ç‡§∞‡§ó‡§§‡§ø ‡§Æ‡•á‡§Ç",
                gaugesSigned: "‡§π‡§∏‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞‡§ø‡§§"
            },
            bn: {
                deployed: "‡¶Æ‡ßã‡¶§‡¶æ‡¶Ø‡¶º‡ßá‡¶®",
                inProgress: "‡¶™‡ßç‡¶∞‡¶ó‡¶§‡¶ø",
                signed: "‡¶∏‡ßç‡¶¨‡¶æ‡¶ï‡ßç‡¶∑‡¶∞‡¶ø‡¶§",
                enterCountry: "‡¶¶‡ßá‡¶∂ ‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®...",
                enterCity: "‡¶∂‡¶π‡¶∞ ‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®...",
                visitWebsite: "‡¶ì‡¶Ø‡¶º‡ßá‡¶¨‡¶∏‡¶æ‡¶á‡¶ü ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®",
                address: "‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ",
                status: "‡¶∏‡ßç‡¶•‡¶ø‡¶§‡¶ø",
                legendDeployed: "‡¶Æ‡ßã‡¶§‡¶æ‡¶Ø‡¶º‡ßá‡¶®",
                legendInProgress: "‡¶™‡ßç‡¶∞‡¶ó‡¶§‡¶ø",
                legendSigned: "‡¶∏‡ßç‡¶¨‡¶æ‡¶ï‡ßç‡¶∑‡¶∞‡¶ø‡¶§",
                noHospitals: "‡¶ï‡ßã‡¶®‡¶ì ‡¶π‡¶æ‡¶∏‡¶™‡¶æ‡¶§‡¶æ‡¶≤ ‡¶â‡¶™‡¶≤‡¶¨‡ßç‡¶ß ‡¶®‡ßá‡¶á",
                gaugesDeployed: "‡¶Æ‡ßã‡¶§‡¶æ‡¶Ø‡¶º‡ßá‡¶®",
                gaugesInProgress: "‡¶™‡ßç‡¶∞‡¶ó‡¶§‡¶ø",
                gaugesSigned: "‡¶∏‡ßç‡¶¨‡¶æ‡¶ï‡ßç‡¶∑‡¶∞‡¶ø‡¶§"
            },
            pt: {
                deployed: "Implantado",
                inProgress: "Em progresso",
                signed: "Assinado",
                enterCountry: "Insira o pa√≠s...",
                enterCity: "Insira a cidade...",
                visitWebsite: "Visitar site",
                address: "Endere√ßo",
                status: "Status",
                legendDeployed: "Implantado",
                legendInProgress: "Em progresso",
                legendSigned: "Assinado",
                noHospitals: "Nenhum hospital dispon√≠vel",
                gaugesDeployed: "Implantado",
                gaugesInProgress: "Em progresso",
                gaugesSigned: "Assinado"
            },
            ru: {
                deployed: "–†–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π",
                inProgress: "–í –ø—Ä–æ—Ü–µ—Å—Å–µ",
                signed: "–ü–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π",
                enterCountry: "–í–≤–µ–¥–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É...",
                enterCity: "–í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥...",
                visitWebsite: "–ü–æ—Å–µ—Ç–∏—Ç—å —Å–∞–π—Ç",
                address: "–ê–¥—Ä–µ—Å",
                status: "–°—Ç–∞—Ç—É—Å",
                legendDeployed: "–†–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π",
                legendInProgress: "–í –ø—Ä–æ—Ü–µ—Å—Å–µ",
                legendSigned: "–ü–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π",
                noHospitals: "–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –±–æ–ª—å–Ω–∏—Ü",
                gaugesDeployed: "–†–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π",
                gaugesInProgress: "–í –ø—Ä–æ—Ü–µ—Å—Å–µ",
                gaugesSigned: "–ü–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π"
            },
            ja: {
                deployed: "Â±ïÈñãÊ∏à„Åø",
                inProgress: "ÈÄ≤Ë°å‰∏≠",
                signed: "ÁΩ≤ÂêçÊ∏à„Åø",
                enterCountry: "ÂõΩ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ...",
                enterCity: "ÈÉΩÂ∏Ç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ...",
                visitWebsite: "„Ç¶„Çß„Éñ„Çµ„Ç§„Éà„ÇíË®™Âïè",
                address: "‰ΩèÊâÄ",
                status: "„Çπ„ÉÜ„Éº„Çø„Çπ",
                legendDeployed: "Â±ïÈñãÊ∏à„Åø",
                legendInProgress: "ÈÄ≤Ë°å‰∏≠",
                legendSigned: "ÁΩ≤ÂêçÊ∏à„Åø",
                noHospitals: "Âà©Áî®ÂèØËÉΩ„Å™ÁóÖÈô¢„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì",
                gaugesDeployed: "Â±ïÈñãÊ∏à„Åø",
                gaugesInProgress: "ÈÄ≤Ë°å‰∏≠",
                gaugesSigned: "ÁΩ≤ÂêçÊ∏à„Åø"
            },
            de: {
                deployed: "Eingesetzt",
                inProgress: "In Bearbeitung",
                signed: "Unterzeichnet",
                enterCountry: "Land eingeben...",
                enterCity: "Stadt eingeben...",
                visitWebsite: "Website besuchen",
                address: "Adresse",
                status: "Status",
                legendDeployed: "Eingesetzt",
                legendInProgress: "In Bearbeitung",
                legendSigned: "Unterzeichnet",
                noHospitals: "Keine Krankenh√§user verf√ºgbar",
                gaugesDeployed: "Eingesetzt",
                gaugesInProgress: "In Bearbeitung",
                gaugesSigned: "Unterzeichnet"
            },
            ko: {
                deployed: "Î∞∞Ìè¨Îê®",
                inProgress: "ÏßÑÌñâ Ï§ë",
                signed: "ÏÑúÎ™ÖÎê®",
                enterCountry: "Íµ≠Í∞Ä ÏûÖÎ†•...",
                enterCity: "ÎèÑÏãú ÏûÖÎ†•...",
                visitWebsite: "ÏõπÏÇ¨Ïù¥Ìä∏ Î∞©Î¨∏",
                address: "Ï£ºÏÜå",
                status: "ÏÉÅÌÉú",
                legendDeployed: "Î∞∞Ìè¨Îê®",
                legendInProgress: "ÏßÑÌñâ Ï§ë",
                legendSigned: "ÏÑúÎ™ÖÎê®",
                noHospitals: "Ïù¥Ïö© Í∞ÄÎä•Ìïú Î≥ëÏõêÏù¥ ÏóÜÏäµÎãàÎã§",
                gaugesDeployed: "Î∞∞Ìè¨Îê®",
                gaugesInProgress: "ÏßÑÌñâ Ï§ë",
                gaugesSigned: "ÏÑúÎ™ÖÎê®"
            },
            vi: {
                deployed: "ƒê√£ tri·ªÉn khai",
                inProgress: "ƒêang ti·∫øn h√†nh",
                signed: "ƒê√£ k√Ω",
                enterCountry: "Nh·∫≠p qu·ªëc gia...",
                enterCity: "Nh·∫≠p th√†nh ph·ªë...",
                visitWebsite: "Truy c·∫≠p website",
                address: "ƒê·ªãa ch·ªâ",
                status: "Tr·∫°ng th√°i",
                legendDeployed: "ƒê√£ tri·ªÉn khai",
                legendInProgress: "ƒêang ti·∫øn h√†nh",
                legendSigned: "ƒê√£ k√Ω",
                noHospitals: "Kh√¥ng c√≥ b·ªánh vi·ªán n√†o",
                gaugesDeployed: "ƒê√£ tri·ªÉn khai",
                gaugesInProgress: "ƒêang ti·∫øn h√†nh",
                gaugesSigned: "ƒê√£ k√Ω"
            },
            tr: {
                deployed: "Yerle≈ütirildi",
                inProgress: "Devam ediyor",
                signed: "ƒ∞mzalandƒ±",
                enterCountry: "√úlke girin...",
                enterCity: "≈ûehir girin...",
                visitWebsite: "Web sitesini ziyaret edin",
                address: "Adres",
                status: "Durum",
                legendDeployed: "Yerle≈ütirildi",
                legendInProgress: "Devam ediyor",
                legendSigned: "ƒ∞mzalandƒ±",
                noHospitals: "Mevcut hastane yok",
                gaugesDeployed: "Yerle≈ütirildi",
                gaugesInProgress: "Devam ediyor",
                gaugesSigned: "ƒ∞mzalandƒ±"
            },
            fa: {
                deployed: "ŸÖÿ≥ÿ™ŸÇÿ±",
                inProgress: "ÿØÿ± ÿ≠ÿßŸÑ Ÿæ€åÿ¥ÿ±ŸÅÿ™",
                signed: "ÿßŸÖÿ∂ÿß ÿ¥ÿØŸá",
                enterCountry: "⁄©ÿ¥Ÿàÿ± ÿ±ÿß Ÿàÿßÿ±ÿØ ⁄©ŸÜ€åÿØ...",
                enterCity: "ÿ¥Ÿáÿ± ÿ±ÿß Ÿàÿßÿ±ÿØ ⁄©ŸÜ€åÿØ...",
                visitWebsite: "ÿ®ÿßÿ≤ÿØ€åÿØ ÿßÿ≤ Ÿàÿ® ÿ≥ÿß€åÿ™",
                address: "ŸÜÿ¥ÿßŸÜ€å",
                status: "Ÿàÿ∂ÿπ€åÿ™",
                legendDeployed: "ŸÖÿ≥ÿ™ŸÇÿ±",
                legendInProgress: "ÿØÿ± ÿ≠ÿßŸÑ Ÿæ€åÿ¥ÿ±ŸÅÿ™",
                legendSigned: "ÿßŸÖÿ∂ÿß ÿ¥ÿØŸá",
                noHospitals: "Ÿá€å⁄Ü ÿ®€åŸÖÿßÿ±ÿ≥ÿ™ÿßŸÜ€å ÿØÿ± ÿØÿ≥ÿ™ÿ±ÿ≥ ŸÜ€åÿ≥ÿ™",
                gaugesDeployed: "ŸÖÿ≥ÿ™ŸÇÿ±",
                gaugesInProgress: "ÿØÿ± ÿ≠ÿßŸÑ Ÿæ€åÿ¥ÿ±ŸÅÿ™",
                gaugesSigned: "ÿßŸÖÿ∂ÿß ÿ¥ÿØŸá"
            },
            ur: {
                deployed: "ÿ™ÿπ€åŸÜÿßÿ™",
                inProgress: "ÿ¨ÿßÿ±€å €Å€í",
                signed: "ÿØÿ≥ÿ™ÿÆÿ∑ ÿ¥ÿØ€Å",
                enterCountry: "ŸÖŸÑ⁄© ÿØÿ±ÿ¨ ⁄©ÿ±€å⁄∫...",
                enterCity: "ÿ¥€Åÿ± ÿØÿ±ÿ¨ ⁄©ÿ±€å⁄∫...",
                visitWebsite: "Ÿà€åÿ® ÿ≥ÿßÿ¶Ÿπ ÿØ€å⁄©⁄æ€å⁄∫",
                address: "Ÿæÿ™€Å",
                status: "ÿ≠ÿßŸÑÿ™",
                legendDeployed: "ÿ™ÿπ€åŸÜÿßÿ™",
                legendInProgress: "ÿ¨ÿßÿ±€å €Å€í",
                legendSigned: "ÿØÿ≥ÿ™ÿÆÿ∑ ÿ¥ÿØ€Å",
                noHospitals: "⁄©Ÿàÿ¶€å €Åÿ≥Ÿæÿ™ÿßŸÑ ÿØÿ≥ÿ™€åÿßÿ® ŸÜ€Å€å⁄∫ €Å€í",
                gaugesDeployed: "ÿ™ÿπ€åŸÜÿßÿ™",
                gaugesInProgress: "ÿ¨ÿßÿ±€å €Å€í",
                gaugesSigned: "ÿØÿ≥ÿ™ÿÆÿ∑ ÿ¥ÿØ€Å"
            },
            it: {
                deployed: "Distribuito",
                inProgress: "In corso",
                signed: "Firmato",
                enterCountry: "Inserisci il paese...",
                enterCity: "Inserisci la citt√†...",
                visitWebsite: "Visita il sito",
                address: "Indirizzo",
                status: "Stato",
                legendDeployed: "Distribuito",
                legendInProgress: "In corso",
                legendSigned: "Firmato",
                noHospitals: "Nessun ospedale disponibile",
                gaugesDeployed: "Distribuito",
                gaugesInProgress: "In corso",
                gaugesSigned: "Firmato"
            },
            ta: {
                deployed: "‡Æ™‡ÆØ‡Æ©‡Øç‡Æ™‡Æü‡ØÅ‡Æ§‡Øç‡Æ§‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ",
                inProgress: "‡ÆÆ‡ØÅ‡Æ©‡Øç‡Æ©‡Øá‡Æ±‡Øç‡Æ±‡Æ§‡Øç‡Æ§‡Æø‡Æ≤‡Øç",
                signed: "‡Æï‡Øà‡ÆØ‡ØÜ‡Æ¥‡ØÅ‡Æ§‡Øç‡Æ§‡Æø‡Æü‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ",
                enterCountry: "‡Æ®‡Ææ‡Æü‡Øç‡Æü‡Øà ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æø‡Æü‡Æµ‡ØÅ‡ÆÆ‡Øç...",
                enterCity: "‡Æ®‡Æï‡Æ∞‡Æ§‡Øç‡Æ§‡Øà ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æø‡Æü‡Æµ‡ØÅ‡ÆÆ‡Øç...",
                visitWebsite: "‡Æµ‡Æ≤‡Øà‡Æ§‡Øç‡Æ§‡Æ≥‡Æ§‡Øç‡Æ§‡Øà‡Æ™‡Øç ‡Æ™‡Ææ‡Æ∞‡Øç‡Æµ‡Øà‡ÆØ‡Æø‡Æü‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç",
                address: "‡ÆÆ‡ØÅ‡Æï‡Æµ‡Æ∞‡Æø",
                status: "‡Æ®‡Æø‡Æ≤‡Øà",
                legendDeployed: "‡Æ™‡ÆØ‡Æ©‡Øç‡Æ™‡Æü‡ØÅ‡Æ§‡Øç‡Æ§‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ",
                legendInProgress: "‡ÆÆ‡ØÅ‡Æ©‡Øç‡Æ©‡Øá‡Æ±‡Øç‡Æ±‡Æ§‡Øç‡Æ§‡Æø‡Æ≤‡Øç",
                legendSigned: "‡Æï‡Øà‡ÆØ‡ØÜ‡Æ¥‡ØÅ‡Æ§‡Øç‡Æ§‡Æø‡Æü‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ",
                noHospitals: "‡ÆÆ‡ØÅ‡Æï‡Ææ‡ÆÆ‡Æø‡Æü‡Æï‡Øç‡Æï‡ØÇ‡Æü‡Æø‡ÆØ ‡ÆÆ‡Æ∞‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ‡Æµ‡ÆÆ‡Æ©‡Øà‡Æï‡Æ≥‡Øç ‡Æá‡Æ≤‡Øç‡Æ≤‡Øà",
                gaugesDeployed: "‡Æ™‡ÆØ‡Æ©‡Øç‡Æ™‡Æü‡ØÅ‡Æ§‡Øç‡Æ§‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ",
                gaugesInProgress: "‡ÆÆ‡ØÅ‡Æ©‡Øç‡Æ©‡Øá‡Æ±‡Øç‡Æ±‡Æ§‡Øç‡Æ§‡Æø‡Æ≤‡Øç",
                gaugesSigned: "‡Æï‡Øà‡ÆØ‡ØÜ‡Æ¥‡ØÅ‡Æ§‡Øç‡Æ§‡Æø‡Æü‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ"
            },
            pl: {
                deployed: "Wdro≈ºone",
                inProgress: "W toku",
                signed: "Podpisany",
                enterCountry: "Wpisz kraj...",
                enterCity: "Wpisz miasto...",
                visitWebsite: "Odwied≈∫ stronƒô",
                address: "Adres",
                status: "Status",
                legendDeployed: "Wdro≈ºone",
                legendInProgress: "W toku",
                legendSigned: "Podpisany",
                noHospitals: "Brak dostƒôpnych szpitali",
                gaugesDeployed: "Wdro≈ºone",
                gaugesInProgress: "W toku",
                gaugesSigned: "Podpisany"
            },
            nl: {
                deployed: "Ingezet",
                inProgress: "In uitvoering",
                signed: "Ondertekend",
                enterCountry: "Voer land in...",
                enterCity: "Voer stad in...",
                visitWebsite: "Bezoek website",
                address: "Adres",
                status: "Status",
                legendDeployed: "Ingezet",
                legendInProgress: "In uitvoering",
                legendSigned: "Ondertekend",
                noHospitals: "Geen beschikbare ziekenhuizen",
                gaugesDeployed: "Ingezet",
                gaugesInProgress: "In uitvoering",
                gaugesSigned: "Ondertekend"
            }
        };

        const hospitals = [
            {
                name: "Centre Hospitalier de Ch√¢lon-sur-Saone",
                lat: 46.7795,
                lon: 4.8527,
                status: "Deployed",
                address: "4 Rue Capitaine Drillien, 71100 Chalon-sur-Sa√¥ne, France",
                website: "http://www.ch-chalon71.fr",
                imageUrl: "https://i.ibb.co/HYs7nHY/b-timent-moderne-dh-pital.webp"
            },
            {
                name: "Centre Hospitalier de Toulon",
                lat: 43.1242,
                lon: 5.928,
                status: "Deployed",
                address: "Avenue du 1er Bataillon des Fusiliers Marins, 83000 Toulon, France",
                website: "http://www.ch-toulon.fr",
                imageUrl: "https://i.ibb.co/HYs7nHY/b-timent-moderne-dh-pital.webp"
            },
            {
                name: "Centre Hospitalier de Hy√®res",
                lat: 43.1175,
                lon: 6.1284,
                status: "Deployed",
                address: "3 Avenue du Dr Jean-Jacques Perron, 83400 Hy√®res, France",
                website: "http://www.ch-hyeres.fr",
                imageUrl: "https://i.ibb.co/HYs7nHY/b-timent-moderne-dh-pital.webp"
            },
            {
                name: "Centre Hospitalier Universitaire de Caen Normandie",
                lat: 49.1829,
                lon: -0.3707,
                status: "Deployed",
                address: "Avenue de la C√¥te de Nacre, 14033 Caen, France",
                website: "http://www.chu-caen.fr",
                imageUrl: "https://i.ibb.co/HYs7nHY/b-timent-moderne-dh-pital.webp"
            },
            {
                name: "Centre Hospitalier Sud Francilien, Corbeil-Essonnes",
                lat: 48.6139,
                lon: 2.4749,
                status: "Deployed",
                address: "40 Avenue Serge Dassault, 91100 Corbeil-Essonnes, France",
                website: "http://www.chsf.fr",
                imageUrl: "https://i.ibb.co/HYs7nHY/b-timent-moderne-dh-pital.webp"
            },
            {
                name: "Groupe Hospitalier Nord-Essonne, Longjumeau",
                lat: 48.6953,
                lon: 2.2999,
                status: "Deployed",
                address: "159 Rue du Pr√©sident Fran√ßois Mitterrand, 91160 Longjumeau, France",
                website: "http://www.ch-nord-essonne.fr",
                imageUrl: "https://i.ibb.co/HYs7nHY/b-timent-moderne-dh-pital.webp"
            },
            {
                name: "Groupe Hospitalier Nord-Essonne, Orsay",
                lat: 48.697,
                lon: 2.1873,
                status: "Deployed",
                address: "4 Place du G√©n√©ral Leclerc, 91400 Orsay, France",
                website: "http://www.ch-nord-essonne.fr",
                imageUrl: "https://i.ibb.co/HYs7nHY/b-timent-moderne-dh-pital.webp"
            },
            {
                name: "Centre Hospitalier Jean Leclaire Sarlat, Sarlat-la-Can√©da",
                lat: 44.8904,
                lon: 1.2161,
                status: "Deployed",
                address: "13 Avenue de la Gare, 24200 Sarlat-la-Can√©da, France",
                website: "http://www.ch-sarlat.fr",
                imageUrl: "https://i.ibb.co/HYs7nHY/b-timent-moderne-dh-pital.webp"
            },
            {
                name: "Centre Hospitalier Samuel Pozzi, Bergerac",
                lat: 44.8532,
                lon: 0.4845,
                status: "Deployed",
                address: "21 Rue du Professeur Pozzi, 24100 Bergerac, France",
                website: "http://www.ch-bergerac.fr",
                imageUrl: "https://i.ibb.co/HYs7nHY/b-timent-moderne-dh-pital.webp"
            },
            {
                name: "Centre Hospitalier de P√©rigueux",
                lat: 45.1853,
                lon: 0.7186,
                status: "Deployed",
                address: "80 Avenue Georges Pompidou, 24000 P√©rigueux, France",
                website: "http://www.ch-perigueux.fr",
                imageUrl: "https://i.ibb.co/HYs7nHY/b-timent-moderne-dh-pital.webp"
            },
            {
                name: "Les Bluets, Paris",
                lat: 48.8499,
                lon: 2.3912,
                status: "Deployed",
                address: "4 Rue Lasson, 75012 Paris, France",
                website: "http://www.lesbluets.fr",
                imageUrl: "https://i.ibb.co/HYs7nHY/b-timent-moderne-dh-pital.webp"
            },
            {
                name: "Centre Hospitalier Universitaire de Rouen Normandie",
                lat: 49.4432,
                lon: 1.0993,
                status: "Signed",
                address: "1 Rue de Germont, 76000 Rouen, France",
                website: "http://www.chu-rouen.fr",
                imageUrl: "https://i.ibb.co/HYs7nHY/b-timent-moderne-dh-pital.webp"
            },
            {
                name: "Centre Hospitalier d'Arpajon",
                lat: 48.5913,
                lon: 2.2423,
                status: "Signed",
                address: "18 Avenue Paul Vaillant Couturier, 91290 Arpajon, France",
                website: "http://www.ch-arpajon.fr",
                imageUrl: "https://i.ibb.co/HYs7nHY/b-timent-moderne-dh-pital.webp"
            }
        ];

        function initApplication() {
            console.log("Initializing application...");
            initMap();
            initGauges();
            addMarkers();
            updateGauges();
        }

        function initMap() {
            console.log("Initializing map...");
            if (!isMapInitialized) {
                map = L.map('map').setView([50, 10], 4);
                isMapInitialized = true;
                updateTileLayer();
            } else {
                console.log("Map already initialized, skipping...");
            }
        }

        function initGauges() {
            console.log("Initializing gauges...");
            ['Deployed', 'In Progress', 'Signed'].forEach(status => {
                const element = document.getElementById(`${status.toLowerCase().replace(' ', '-')}-progress`);
                if (element) {
                    const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
                    svg.setAttribute("viewBox", "0 0 36 36");
                    svg.innerHTML = `
                        <path d="M18 2.0845
                            a 15.9155 15.9155 0 0 1 0 31.831
                            a 15.9155 15.9155 0 0 1 0 -31.831"
                            fill="none"
                            stroke="#eee"
                            stroke-width="3"
                        />
                        <path d="M18 2.0845
                            a 15.9155 15.9155 0 0 1 0 31.831
                            a 15.9155 15.9155 0 0 1 0 -31.831"
                            fill="none"
                            stroke="${colors[status]}"
                            stroke-width="3"
                            stroke-dasharray="0, 100"
                        />
                    `;
                    element.innerHTML = '';
                    element.appendChild(svg);

                    const valueContainer = document.createElement('div');
                    valueContainer.classList.add('gauge-value');
                    valueContainer.textContent = '0';
                    element.appendChild(valueContainer);

                    gauges[status] = {
                        path: svg.querySelector(`path[stroke="${colors[status]}"]`),
                        element: element
                    };
                }
            });
            isChartInitialized = true;
        }

        function updateGauges() {
            if (!isChartInitialized) {
                console.warn("Charts not initialized, skipping gauge update");
                return;
            }

            const statusCounts = hospitals.reduce((acc, hospital) => {
                acc[hospital.status] = (acc[hospital.status] || 0) + 1;
                return acc;
            }, {});

            const totalHospitals = hospitals.length;

            ['Deployed', 'In Progress', 'Signed'].forEach(status => {
                const count = statusCounts[status] || 0;
                const percentage = (count / totalHospitals) * 100 || 0;

                if (gauges[status]) {
                    gauges[status].path.setAttribute("stroke-dasharray", `${percentage}, 100`);

                    const valueElement = gauges[status].element.querySelector('.gauge-value');
                    if (valueElement) {
                        valueElement.textContent = count;
                    }

                    const percentageElement = gauges[status].element.nextElementSibling;
                    if (percentageElement) {
                        percentageElement.textContent = `(${percentage.toFixed(1)}%)`;
                    }
                }
            });
        }

        function toggleTheme() {
            darkMode = !darkMode;
            document.body.classList.toggle('dark-mode');
            updateTileLayer();
        }

        function updateTileLayer() {
            if (map.hasLayer(window.currentTileLayer)) {
                map.removeLayer(window.currentTileLayer);
            }
            window.currentTileLayer = L.tileLayer(
                darkMode
                    ? 'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png'
                    : 'https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png',
                {
                    maxZoom: 19
                }
            ).addTo(map);
        }

        function filterHospitals(status) {
            if (!status) return; // Ajout d'une v√©rification de s√©curit√©
            const tagElement = document.querySelector(`.status-tag[data-status="${status}"]`);
            if (!tagElement) return; // Ajout d'une autre v√©rification de s√©curit√©

            if (activeStatus.includes(status)) {
                activeStatus = activeStatus.filter(s => s !== status);
                tagElement.classList.remove('active');
            } else {
                activeStatus.push(status);
                tagElement.classList.add('active');
            }

            addMarkers();
        }

        function extractLocationInfo(address) {
            const parts = address.split(',').map(part => part.trim());
            return {
                city: parts[parts.length - 2] || '',
                country: parts[parts.length - 1] || ''
            };
        }

        function normalizeString(str) {
            return str.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
        }

        function addMarkers() {
            console.log("Adding markers...");
            markers.forEach(marker => map.removeLayer(marker));
            markers = [];

            const selectedContinent = document.getElementById('continent-select').value;
            const selectedCountry = document.getElementById('country-filter').value.toLowerCase();
            const selectedCity = document.getElementById('city-filter').value.toLowerCase();

            hospitals.forEach(hospital => {
                const { city, country } = extractLocationInfo(hospital.address);
                
                const statusMatch = activeStatus.length === 0 || activeStatus.includes(hospital.status);
                const continentMatch = !selectedContinent || getContinent(hospital.lat, hospital.lon) === selectedContinent;
                const countryMatch = !selectedCountry || country.toLowerCase().includes(selectedCountry);
                const cityMatch = !selectedCity || city.toLowerCase().includes(selectedCity);

                if (statusMatch && continentMatch && countryMatch && cityMatch) {
                    const selectedLanguage = document.getElementById('language-select').value;
                    const currentTranslations = translations[selectedLanguage] || translations['en'];

                    const statusTag = getStatusTag(hospital.status, currentTranslations);

                    const popupContent = `
                        <div class="popup-content">
                            <h3 class="popup-title" style="color: #00aaff;">${hospital.name}</h3>
                            <img class="popup-image" src="${hospital.imageUrl}" alt="${hospital.name}">
                            <p><strong>${currentTranslations.address}:</strong><br>${hospital.address}</p>
                            <p><a href="${hospital.website}" target="_blank" style="color: var(--hyperlink-color); font-size: 1.2em;">${currentTranslations.visitWebsite}</a></p>
                            <p><strong>${currentTranslations.status}:</strong> ${statusTag}</p>
                        </div>
                    `;

                    const marker = L.circleMarker([hospital.lat, hospital.lon], {
                        radius: 8,
                        fillColor: getColor(hospital.status),
                        color: "#fff",
                        weight: 1,
                        opacity: 1,
                        fillOpacity: 0.8
                    }).addTo(map);
                    
                    marker.hospitalData = hospital;
                    marker.bindPopup(popupContent);
                    markers.push(marker);
                }
            });

            console.log(`${markers.length} markers added`);
            updateGauges();
        }

        function getContinent(lat, lon) {
            if (lat >= 40 && lon >= -10 && lon <= 60) return "Europe";
            if (lat <= 40 && lat >= -40 && lon >= -10 && lon <= 60) return "Africa";
            // Ajoutez ici la logique pour les autres continents
            return "Unknown";
        }

        function getColor(status) {
            switch (status) {
                case 'Deployed':
                    return '#28a745';
                case 'In Progress':
                    return '#ffc107';
                case 'Signed':
                    return '#007bff';
                default:
                    return '#6c757d';
            }
        }

        function getStatusTag(status, translations) {
            const statusKey = status.toLowerCase().replace(" ", "");
            const statusText = translations[statusKey] || status;
            switch (status) {
                case 'Signed':
                    return `<span class="status-tag status-signed">${statusText}</span>`;
                case 'Deployed':
                    return `<span class="status-tag status-deployed">${statusText}</span>`;
                case 'In Progress':
                    return `<span class="status-tag status-in-progress">${statusText}</span>`;
                default:
                    return `<span class="status-tag">Unknown</span>`;
            }
        }

        function toggleLegend() {
            const legendContainer = document.querySelector('.legend-container');
            const isVisible = legendContainer.style.display !== 'none';
            legendContainer.style.display = isVisible ? 'none' : 'block';
        }

        function toggleMenu() {
            const controls = document.querySelector('.controls');
            controls.style.display = controls.style.display === 'none' ? 'block' : 'none';
        }

        function adjustForMobile() {
            const isMobile = window.innerWidth <= 767;
            const isPortrait = window.innerHeight > window.innerWidth;
            const legendContainer = document.querySelector('.legend-container');
            const chartContainer = document.querySelector('.chart-container');

            if (isMobile && isPortrait) {
                legendContainer.style.display = 'none';
                chartContainer.style.flexDirection = 'row';
            } else {
                legendContainer.style.display = 'block';
                chartContainer.style.flexDirection = 'row';
            }
        }

        function applyTranslations(language) {
            const t = translations[language] || translations['en'];

            document.querySelector('.status-deployed').textContent = t.deployed || 'Deployed';
            document.querySelector('.status-in-progress').textContent = t.inProgress || 'In Progress';
            document.querySelector('.status-signed').textContent = t.signed || 'Signed';

            document.getElementById('country-filter').setAttribute('placeholder', t.enterCountry);
            document.getElementById('city-filter').setAttribute('placeholder', t.enterCity);

            document.querySelector('.legend-item:nth-child(1) .legend-color').nextSibling.textContent = t.legendDeployed;
            document.querySelector('.legend-item:nth-child(2) .legend-color').nextSibling.textContent = t.legendInProgress;
            document.querySelector('.legend-item:nth-child(3) .legend-color').nextSibling.textContent = t.legendSigned;

            document.querySelectorAll('.gauge-label').forEach((label, index) => {
                if (index === 0) label.textContent = t.gaugesDeployed;
                if (index === 1) label.textContent = t.gaugesInProgress;
                if (index === 2) label.textContent = t.gaugesSigned;
           });

            addMarkers();
        }

        document.getElementById('language-select').addEventListener('change', function() {
            const selectedLanguage = this.value;
            applyTranslations(selectedLanguage);
            addMarkers();
        });

        document.addEventListener('DOMContentLoaded', () => {
            console.log("DOM content loaded");
            initApplication();

            const filterInputs = document.querySelectorAll('#country-filter, #city-filter');
            filterInputs.forEach(input => {
                input.addEventListener('input', debounce(addMarkers, 300));
            });

            document.getElementById('language-select').addEventListener('change', addMarkers);
            document.getElementById('continent-select').addEventListener('change', addMarkers);
            document.getElementById('country-filter').addEventListener('input', addMarkers);
            document.getElementById('city-filter').addEventListener('input', addMarkers);
            document.querySelectorAll('.status-tag').forEach(tag => {
                tag.addEventListener('click', (e) => {
                    const status = e.target.dataset.status;
                    if (status) {
                        filterHospitals(status);
                    }
                });
            });
            document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
            document.getElementById('hamburger').addEventListener('click', toggleMenu);
            document.getElementById('legend-toggle').addEventListener('click', toggleLegend);

            adjustForMobile();
        });

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        window.addEventListener('load', adjustForMobile);
        window.addEventListener('resize', adjustForMobile);
    </script>
</body>
</html>