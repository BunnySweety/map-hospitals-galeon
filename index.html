<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Map of Hospitals Using Galeon</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <!-- MarkerCluster CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css" />
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- i18next for multilingual support -->
    <script src="https://unpkg.com/i18next@20.1.0/i18next.min.js"></script>

    <style>
        body, html {
            height: 100%;
            margin: 0;
        }
        #map {
            height: 100%;
            width: 100%;
            transition: opacity 0.5s ease-in-out;
        }
        #map.hidden {
            opacity: 0;
        }
        #filters {
            position: absolute;
            top: 10px;
            left: 60px;
            z-index: 1000;
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
        }
        #legend {
            position: absolute;
            bottom: 10px;
            left: 10px;
            z-index: 1000;
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
        }
        #chartContainer {
            position: absolute;
            bottom: 10px;
            right: 10px;
            z-index: 1000;
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
        }
        #themeToggle {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body>
    <div id="filters">
        <label for="languageSelect" data-i18n="language">Language:</label>
        <select id="languageSelect">
            <option value="en">English</option>
            <option value="zh">Chinese (Mandarin)</option>
            <option value="es">Spanish</option>
            <option value="hi">Hindi</option>
            <option value="ar">Arabic</option>
            <option value="pt">Portuguese</option>
            <option value="bn">Bengali</option>
            <option value="ru">Russian</option>
            <option value="ja">Japanese</option>
            <option value="pa">Punjabi</option>
            <option value="de">German</option>
            <option value="ko">Korean</option>
            <option value="fr">French</option>
            <option value="te">Telugu</option>
            <option value="mr">Marathi</option>
            <option value="ta">Tamil</option>
            <option value="tr">Turkish</option>
            <option value="vi">Vietnamese</option>
            <option value="it">Italian</option>
            <option value="th">Thai</option>
        </select>
        <br><br>

        <!-- Ajout du filtrage par continent -->
        <label for="continentSelect" data-i18n="continent">Continent:</label>
        <select id="continentSelect">
            <option value="all">All</option>
            <option value="Europe">Europe</option>
            <option value="Asia">Asia</option>
            <option value="Africa">Africa</option>
            <option value="North America">North America</option>
            <option value="South America">South America</option>
            <option value="Oceania">Oceania</option>
        </select>
        <br><br>

        <!-- Filtrage par pays et ville avec champ texte -->
        <label for="countryFilter" data-i18n="country">Country:</label>
        <input type="text" id="countryFilter" placeholder="Enter country...">
        <br><br>
        <label for="cityFilter" data-i18n="city">City:</label>
        <input type="text" id="cityFilter" placeholder="Enter city...">
        <br><br>

        <!-- Remplacer les boutons de filtrage par des checkboxs -->
        <label><input type="checkbox" id="deployedFilter" checked> <span data-i18n="deployed" style="color:green;">Deployed</span></label><br>
        <label><input type="checkbox" id="inProgressFilter" checked> <span data-i18n="inProgress" style="color:orange;">In Progress</span></label><br>
        <label><input type="checkbox" id="signedFilter" checked> <span data-i18n="signed" style="color:blue;">Signed</span></label><br>
    </div>

    <div id="legend">
        <p><span style="color:green;">●</span> <span data-i18n="deployed">Deployed</span></p>
        <p><span style="color:orange;">●</span> <span data-i18n="inProgress">In Progress</span></p>
        <p><span style="color:blue;">●</span> <span data-i18n="signed">Signed</span></p>
    </div>

    <div id="chartContainer">
        <canvas id="statsChart" width="200" height="200"></canvas>
    </div>

    <div id="themeToggle">
        <button id="toggleTheme" data-i18n="toggleTheme">Dark/Light Mode</button>
    </div>

    <div id="map"></div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <!-- MarkerCluster JS -->
    <script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>

    <script>
        var hospitals = [
            {
                "name": "Hospital 1",
                "city": "Paris",
                "country": "France",
                "continent": "Europe",
                "lat": 48.8566,
                "lon": 2.3522,
                "status": "deployed",
                "address": "1 Rue de l'Hôpital, Paris",
                "website": "http://hospital1.com",
                "photo": "https://i.ibb.co/HYs7nHY/b-timent-moderne-dh-pital.webp"
            },
            {
                "name": "Hospital 2",
                "city": "Lyon",
                "country": "France",
                "continent": "Europe",
                "lat": 45.764,
                "lon": 4.8357,
                "status": "in-progress",
                "address": "2 Rue de l'Hôpital, Lyon",
                "website": "http://hospital2.com",
                "photo": "https://i.ibb.co/HYs7nHY/b-timent-moderne-dh-pital.webp"
            },
            {
                "name": "Hospital 3",
                "city": "Berlin",
                "country": "Germany",
                "continent": "Europe",
                "lat": 52.52,
                "lon": 13.405,
                "status": "signed",
                "address": "3 Straße Krankenhaus, Berlin",
                "website": "http://hospital3.com",
                "photo": "https://i.ibb.co/HYs7nHY/b-timent-moderne-dh-pital.webp"
            }
        ];

        var map = L.map('map').setView([48.8566, 2.3522], 5);
        var markersCluster = L.markerClusterGroup();

        // Utilisation de CartoDB pour les tuiles
        var lightTiles = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png');
        var darkTiles = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png');

        lightTiles.addTo(map);

        // Définir des cercles en fonction du statut
        function getStatusColor(status) {
            if (status === 'deployed') return 'green';
            if (status === 'in-progress') return 'orange';
            return 'blue';
        }

        function createMarker(hospital) {
            var marker = L.circleMarker([hospital.lat, hospital.lon], {
                radius: 8,
                fillColor: getStatusColor(hospital.status),
                color: getStatusColor(hospital.status),
                weight: 1,
                opacity: 1,
                fillOpacity: 0.8
            });
            marker.bindPopup(generatePopupContent(hospital));
            markersCluster.addLayer(marker);
        }

        function generatePopupContent(hospital) {
            return `
                <div style="text-align: center;">
                    <b>${hospital.name}</b><br>
                    <img src="${hospital.photo}" style="width:100px; height:auto;" alt="Photo"><br>
                    <a href="${hospital.website}" target="_blank">${i18next.t('visitWebsite') || 'Visit Website'}</a><br>
                    <p>${i18next.t('status') || 'Status'}: <span style="color: ${getStatusColor(hospital.status)};">${i18next.t(hospital.status) || hospital.status}</span></p>
                    <p>${i18next.t('address') || 'Address'}: ${hospital.address}</p>
                </div>
            `;
        }

        function refreshPopups() {
            markersCluster.eachLayer(function(marker) {
                var hospital = marker.options.hospitalData;
                marker.setPopupContent(generatePopupContent(hospital));
            });
        }

        hospitals.forEach(function(hospital) {
            var marker = L.circleMarker([hospital.lat, hospital.lon], {
                radius: 8,
                fillColor: getStatusColor(hospital.status),
                color: getStatusColor(hospital.status),
                weight: 1,
                opacity: 1,
                fillOpacity: 0.8,
                hospitalData: hospital  // Stocker les données hospitalières dans le marqueur pour les popups
            });
            marker.bindPopup(generatePopupContent(hospital));
            markersCluster.addLayer(marker);
        });
        map.addLayer(markersCluster);

        // Filtrer les hôpitaux en fonction des checkboxs, continent, pays et ville
        function filterHospitals() {
            var continent = document.getElementById('continentSelect').value.toLowerCase();
            var country = document.getElementById('countryFilter').value.toLowerCase();
            var city = document.getElementById('cityFilter').value.toLowerCase();
            var deployedChecked = document.getElementById('deployedFilter').checked;
            var inProgressChecked = document.getElementById('inProgressFilter').checked;
            var signedChecked = document.getElementById('signedFilter').checked;

            markersCluster.clearLayers();
            hospitals.forEach(function(hospital) {
                var continentMatches = (continent === 'all' || hospital.continent.toLowerCase() === continent);
                var countryMatches = hospital.country.toLowerCase().includes(country);
                var cityMatches = hospital.city.toLowerCase().includes(city);
                var statusMatches = (deployedChecked && hospital.status === 'deployed') ||
                                    (inProgressChecked && hospital.status === 'in-progress') ||
                                    (signedChecked && hospital.status === 'signed');

                if (continentMatches && countryMatches && cityMatches && statusMatches) {
                    createMarker(hospital);
                }
            });
        }

        // Appliquer le filtre à chaque modification des champs
        document.getElementById('continentSelect').addEventListener('change', filterHospitals);
        document.getElementById('countryFilter').addEventListener('input', filterHospitals);
        document.getElementById('cityFilter').addEventListener('input', filterHospitals);
        document.getElementById('deployedFilter').addEventListener('change', filterHospitals);
        document.getElementById('inProgressFilter').addEventListener('change', filterHospitals);
        document.getElementById('signedFilter').addEventListener('change', filterHospitals);

        // Statistiques avec Chart.js
        var ctx = document.getElementById('statsChart').getContext('2d');
        var chart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: [
                    i18next.t('deployed') || 'Deployed',
                    i18next.t('inProgress') || 'In Progress',
                    i18next.t('signed') || 'Signed'
                ],
                datasets: [{
                    label: i18next.t('status') || 'Status',
                    data: [
                        hospitals.filter(h => h.status === 'deployed').length,
                        hospitals.filter(h => h.status === 'in-progress').length,
                        hospitals.filter(h => h.status === 'signed').length
                    ],
                    backgroundColor: ['green', 'orange', 'blue']
                }]
            }
        });

        // Basculer entre mode clair et mode sombre
        document.getElementById('toggleTheme').addEventListener('click', function() {
            document.getElementById('map').classList.add('hidden');
            setTimeout(function() {
                if (map.hasLayer(lightTiles)) {
                    map.removeLayer(lightTiles);
                    map.addLayer(darkTiles);
                } else {
                    map.removeLayer(darkTiles);
                    map.addLayer(lightTiles);
                }
                document.getElementById('map').classList.remove('hidden');
            }, 500);
        });

        i18next.init({
            lng: 'en',
            fallbackLng: 'en',
            resources: {
                en: {
                    translation: {
                        "language": "Language",
                        "continent": "Continent",
                        "country": "Country",
                        "city": "City",
                        "deployed": "Deployed",
                        "inProgress": "In Progress",
                        "signed": "Signed",
                        "status": "Status",
                        "visitWebsite": "Visit Website",
                        "address": "Address",
                        "all": "All",
                        "toggleTheme": "Dark/Light Mode"
                    }
                },
                fr: {
                    translation: {
                        "language": "Langue",
                        "continent": "Continent",
                        "country": "Pays",
                        "city": "Ville",
                        "deployed": "Déployé",
                        "inProgress": "En cours",
                        "signed": "Signé",
                        "status": "Statut",
                        "visitWebsite": "Visitez le site",
                        "address": "Adresse",
                        "all": "Tous",
                        "toggleTheme": "Mode Sombre/Clair"
                    }
                },
                es: {
                    translation: {
                        "language": "Idioma",
                        "continent": "Continente",
                        "country": "País",
                        "city": "Ciudad",
                        "deployed": "Desplegado",
                        "inProgress": "En Progreso",
                        "signed": "Firmado",
                        "status": "Estado",
                        "visitWebsite": "Visitar Sitio Web",
                        "address": "Dirección",
                        "all": "Todos",
                        "toggleTheme": "Modo Oscuro/Claro"
                    }
                },
                de: {
                    translation: {
                        "language": "Sprache",
                        "continent": "Kontinent",
                        "country": "Land",
                        "city": "Stadt",
                        "deployed": "Bereitgestellt",
                        "inProgress": "In Bearbeitung",
                        "signed": "Unterzeichnet",
                        "status": "Status",
                        "visitWebsite": "Website besuchen",
                        "address": "Adresse",
                        "all": "Alle",
                        "toggleTheme": "Dunkler/Heller Modus"
                    }
                },
                it: {
                    translation: {
                        "language": "Lingua",
                        "continent": "Continente",
                        "country": "Paese",
                        "city": "Città",
                        "deployed": "Distribuito",
                        "inProgress": "In Corso",
                        "signed": "Firmato",
                        "status": "Stato",
                        "visitWebsite": "Visita il Sito",
                        "address": "Indirizzo",
                        "all": "Tutti",
                        "toggleTheme": "Modalità Scura/Chiara"
                    }
                },
                pt: {
                    translation: {
                        "language": "Língua",
                        "continent": "Continente",
                        "country": "País",
                        "city": "Cidade",
                        "deployed": "Implantado",
                        "inProgress": "Em Progresso",
                        "signed": "Assinado",
                        "status": "Status",
                        "visitWebsite": "Visitar Site",
                        "address": "Endereço",
                        "all": "Todos",
                        "toggleTheme": "Modo Escuro/Claro"
                    }
                },
                ru: {
                    translation: {
                        "language": "Язык",
                        "continent": "Континент",
                        "country": "Страна",
                        "city": "Город",
                        "deployed": "Развернуто",
                        "inProgress": "В процессе",
                        "signed": "Подписано",
                        "status": "Статус",
                        "visitWebsite": "Посетить сайт",
                        "address": "Адрес",
                        "all": "Все",
                        "toggleTheme": "Тёмный/Светлый режим"
                    }
                },
                zh: {
                    translation: {
                        "language": "语言",
                        "continent": "大陆",
                        "country": "国家",
                        "city": "城市",
                        "deployed": "已部署",
                        "inProgress": "进行中",
                        "signed": "已签署",
                        "status": "状态",
                        "visitWebsite": "访问网站",
                        "address": "地址",
                        "all": "所有",
                        "toggleTheme": "深色/浅色模式"
                    }
                },
                hi: {
                    translation: {
                        "language": "भाषा",
                        "continent": "महाद्वीप",
                        "country": "देश",
                        "city": "शहर",
                        "deployed": "तैनात",
                        "inProgress": "प्रगति पर",
                        "signed": "हस्ताक्षरित",
                        "status": "स्थिति",
                        "visitWebsite": "वेबसाइट देखें",
                        "address": "पता",
                        "all": "सभी",
                        "toggleTheme": "डार्क/लाइट मोड"
                    }
                },
                ar: {
                    translation: {
                        "language": "لغة",
                        "continent": "قارة",
                        "country": "بلد",
                        "city": "مدينة",
                        "deployed": "تم النشر",
                        "inProgress": "قيد التقدم",
                        "signed": "تم التوقيع",
                        "status": "الحالة",
                        "visitWebsite": "زيارة الموقع",
                        "address": "العنوان",
                        "all": "الكل",
                        "toggleTheme": "الوضع الداكن/السطوع"
                    }
                },
                ko: {
                    translation: {
                        "language": "언어",
                        "continent": "대륙",
                        "country": "국가",
                        "city": "도시",
                        "deployed": "배치됨",
                        "inProgress": "진행 중",
                        "signed": "서명됨",
                        "status": "상태",
                        "visitWebsite": "웹사이트 방문",
                        "address": "주소",
                        "all": "모두",
                        "toggleTheme": "다크/라이트 모드"
                    }
                },
                ja: {
                    translation: {
                        "language": "言語",
                        "continent": "大陸",
                        "country": "国",
                        "city": "市",
                        "deployed": "展開済み",
                        "inProgress": "進行中",
                        "signed": "署名済み",
                        "status": "ステータス",
                        "visitWebsite": "ウェブサイトを訪問",
                        "address": "住所",
                        "all": "すべて",
                        "toggleTheme": "ダーク/ライトモード"
                    }
                },
                pa: {
                    translation: {
                        "language": "ਭਾਸ਼ਾ",
                        "continent": "ਮਹਾਦੀਪ",
                        "country": "ਦੇਸ਼",
                        "city": "ਸ਼ਹਿਰ",
                        "deployed": "ਤੈਨਾਤ",
                        "inProgress": "ਚਲ ਰਿਹਾ ਹੈ",
                        "signed": "ਦਸਤਖ਼ਤ ਕੀਤੇ",
                        "status": "ਸਥਿਤੀ",
                        "visitWebsite": "ਵੈਬਸਾਈਟ ਵੇਖੋ",
                        "address": "ਪਤਾ",
                        "all": "ਸਾਰੇ",
                        "toggleTheme": "ਡਾਰਕ/ਲਾਈਟ ਮੋਡ"
                    }
                },
                bn: {
                    translation: {
                        "language": "ভাষা",
                        "continent": "মহাদেশ",
                        "country": "দেশ",
                        "city": "শহর",
                        "deployed": "মোতায়েন",
                        "inProgress": "চলমান",
                        "signed": "স্বাক্ষরিত",
                        "status": "অবস্থা",
                        "visitWebsite": "ওয়েবসাইট দেখুন",
                        "address": "ঠিকানা",
                        "all": "সব",
                        "toggleTheme": "ডার্ক/লাইট মোড"
                    }
                },
                vi: {
                    translation: {
                        "language": "Ngôn ngữ",
                        "continent": "Châu lục",
                        "country": "Quốc gia",
                        "city": "Thành phố",
                        "deployed": "Đã triển khai",
                        "inProgress": "Đang thực hiện",
                        "signed": "Đã ký",
                        "status": "Trạng thái",
                        "visitWebsite": "Truy cập trang web",
                        "address": "Địa chỉ",
                        "all": "Tất cả",
                        "toggleTheme": "Chế độ Tối/Sáng"
                    }
                },
                th: {
                    translation: {
                        "language": "ภาษา",
                        "continent": "ทวีป",
                        "country": "ประเทศ",
                        "city": "เมือง",
                        "deployed": "ปรับใช้แล้ว",
                        "inProgress": "อยู่ในระหว่างดำเนินการ",
                        "signed": "ลงนามแล้ว",
                        "status": "สถานะ",
                        "visitWebsite": "เยี่ยมชมเว็บไซต์",
                        "address": "ที่อยู่",
                        "all": "ทั้งหมด",
                        "toggleTheme": "โหมดมืด/โหมดสว่าง"
                    }
                }
            }
        }, function(err, t) {
            if (err) return console.error('Something went wrong:', err);
            updateUI();
        });

        function updateUI() {
            document.querySelectorAll('[data-i18n]').forEach(function(element) {
                element.textContent = i18next.t(element.getAttribute('data-i18n'));
            });

            chart.data.labels = [
                i18next.t('deployed') || 'Deployed',
                i18next.t('inProgress') || 'In Progress',
                i18next.t('signed') || 'Signed'
            ];
            chart.update();

            refreshPopups();  // Mettre à jour les popups avec les nouvelles traductions
        }

        document.getElementById('languageSelect').addEventListener('change', function() {
            var selectedLanguage = this.value;
            i18next.changeLanguage(selectedLanguage, function(err, t) {
                if (err) return console.error('Something went wrong:', err);
                updateUI();
            });
        });
    </script>
</body>
</html>